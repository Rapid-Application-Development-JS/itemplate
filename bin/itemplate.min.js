!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.itemplate=t()}(this,function(){function e(e){for(var t={},r=e.split(","),a=0;a<r.length;a++)t[r[a]]=!0;return t}function t(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",r=0;12>r;r++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}function r(e){return e.replace(M.escape,function(e){return M.MAP[e]})}function a(){C.length=0,K={},z=null,C.push("var o=lib.elementOpen,c=lib.elementClose,t=lib.text,v=lib.elementVoid;")}function n(e,t,r){var a=new RegExp(t+"(.*?)"+r,"g"),n=!0,s=!0,o=!0,i=e.replace(a,function(e,t,r,a){return o=!1,0!==r?t="'+"+t:n=!1,a.length-(r+e.length)>0?t+="+'":s=!1,t});return{isStatic:o,value:(n?"'":"")+i+(s?"'":""),unwrap:i}}function s(e){return e.replace(M.template.interpolate,function(e,t){return M.accessory.open+t+M.accessory.close}).replace(M.template.escape,function(e,t){return M.accessory.open+r(t)+M.accessory.close}).replace(M.template.evaluate,function(e,t){return"<evaluate>"+t.replace(j," ").trim()+"</evaluate>"})}function o(e,t,r){var a="";if(0!==t.length){if("string"==typeof t)a=r?t:"'"+t.replace("'","\\'")+"'";else for(var n=0;n<t.length;n++)n>0&&(a+=", "),a+=t[n];C.push(e+"("+a+");")}}function i(e,t){C.push(t?e:e.replace(j," "))}function c(e){for(var t=0,r={};t<e.length;t+=1)r[e[t].name]=e[t].value;return r}function l(e,r,a){var s,l=c(r),p=["'"+e+"'"],f=[],h=!1,d=!1,m=!1;if(l.hasOwnProperty(M.staticArray)&&(m=n(l[M.staticArray],"<evaluate>","</evaluate>"),m=m.isStatic?m.unwrap:m.value,m=l[M.staticArray]?m:t(),delete l[M.staticArray]),l.hasOwnProperty(M.staticKey)&&(h=n(l[M.staticKey],"<evaluate>","</evaluate>"),d=h.isStatic,h=l[M.staticKey]?h.value:t(),delete l[M.staticKey]),-1===P.indexOf(e)){for(var g in l)l.hasOwnProperty(g)&&(1==p.length&&(p.push(null),p.push(null)),s=n(l[g],M.accessory.open,M.accessory.close),m&&s.isStatic?(f.push("'"+g+"'"),f.push(s.value)):(p.push("'"+g+"'"),p.push(s.value)));m&&!h?p[1]="'"+t()+"'":h&&(p[1]=d?"'"+h+"'":h),m&&(K[m]="["+f.join(",")+"]",p[2]=m),a?k.hasOwnProperty(e)?i("helpers['"+e+"']("+u(l)+");",!0):o("v",p):o("o",p)}z=e}function u(e){var t=["{"];for(var r in e)e.hasOwnProperty(r)&&(t.length>1&&t.push(","),t.push(r+":"+n(e[r],M.accessory.open,M.accessory.close).value));return t.push("}"),t.join("")}function p(e){var t;if(-1!==P.indexOf(z))i(e);else if(-1===A.indexOf(z))t=e.replace(j,"").trim(),t.length>0&&o("t",n(t,M.accessory.open,M.accessory.close).value,!0);else for(var r=e.split(j),a=0;a<r.length;a++)t=r[a],j.exec(t)?o("t",S,!0):o("t",n(t,M.accessory.open,M.accessory.close).value,!0)}function f(e){-1===P.indexOf(e)&&o("c",e)}var h=/^<([-A-Za-z0-9_]+)((?:[\s\w\-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,d=/^<\/([-A-Za-z0-9_]+)[^>]*>/,m=/([-A-Za-z0-9_]+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g,g=e("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed"),v=e("address,applet,blockquote,button,center,dd,del,dir,div,dl,dt,fieldset,form,frameset,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,script,table,tbody,td,tfoot,th,thead,tr,ul"),y=e("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),b=e("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),x=e("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),w=e(""),O=function(e,t){function r(e,r,n,s){if(r=r.toLowerCase(),v[r])for(;i.last()&&y[i.last()];)a("",i.last());if(b[r]&&i.last()==r&&a("",r),s=g[r]||!!s,s||i.push(r),t.start){var o=[];n.replace(m,function(e,t){var r=arguments[2]?arguments[2]:arguments[3]?arguments[3]:arguments[4]?arguments[4]:x[t]?t:"";o.push({name:t,value:r,escaped:r.replace(/(^|[^\\])"/g,'$1\\"')})}),t.start&&t.start(r,o,s)}}function a(e,r){var a;if(r)for(a=i.length-1;a>=0&&i[a]!=r;a--);else a=0;if(a>=0){for(var n=i.length-1;n>=a;n--)t.end&&t.end(i[n]);i.length=a}}var n,s,o,i=[],c=e;for(i.last=function(){return this[this.length-1]};e;){if(s=!0,i.last()&&w[i.last()])e=e.replace(new RegExp("(.*)</"+i.last()+"[^>]*>"),function(e,r){return r=r.replace(/<!--(.*?)-->/g,"$1").replace(/<!\[CDATA\[(.*?)]]>/g,"$1"),t.chars&&t.chars(r),""}),a("",i.last());else if(0==e.indexOf("<!--")?(n=e.indexOf("-->"),n>=0&&(t.comment&&t.comment(e.substring(4,n)),e=e.substring(n+3),s=!1)):0==e.indexOf("</")?(o=e.match(d),o&&(e=e.substring(o[0].length),o[0].replace(d,a),s=!1)):0==e.indexOf("<")&&(o=e.match(h),o&&(e=e.substring(o[0].length),o[0].replace(h,r),s=!1)),s){n=e.indexOf("<");var l=0>n?e:e.substring(0,n);e=0>n?"":e.substring(n),t.chars&&t.chars(l)}if(e==c)throw"Parse Error: "+e;c=e}a()},A=["pre","script"],P=["evaluate"],j=/(\r\n|\n|\r)/gm,S="String.fromCharCode(10)";"object"==typeof w&&(w[P]=!0);var k={},C=[],K={},z=null,M={parameterName:"data",functionName:function(e,t){return e},template:{evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},escape:/[&<>]/g,MAP:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ignore:"js",accessory:{open:"{%",close:"%}"},staticKey:"static-key",staticArray:"static-array"},N={compile:function(e,t){var r;a(),O(s(e),{start:l,chars:p,end:f});var n="";for(var o in K)K.hasOwnProperty(o)&&(n+="var "+o+"="+K[o]+";");return t?(n+="return function("+M.parameterName+"){"+C.join("")+"}",r=new Function("lib","helpers",n)(t,k)):r=new Function(M.parameterName,"lib","helpers",C.join("")),r},options:function(e){for(var t in e)e.hasOwnProperty(t)&&(M[t]=e[t])},registerHelper:function(e,t){k[e]=t},unregisterHelper:function(e){delete k[e]}};return N});