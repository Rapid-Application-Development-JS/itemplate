!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.itemplate=t()}(this,function(){function e(e){for(var t={},r=e.split(","),n=0;n<r.length;n++)t[r[n]]=!0;return t}function t(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",r=0;12>r;r++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}function r(e){return e.replace(M.escape,function(e){return M.MAP[e]})}function n(){C.length=0,z={},K=null,C.push("var o=lib.elementOpen,c=lib.elementClose,t=lib.text,v=lib.elementVoid;")}function a(e,t,r){var n=new RegExp(t+"(.*?)"+r,"g"),a=!0,s=!0,o=!0,i=e.replace(n,function(e,t,r,n){return o=!1,0!==r?t="'+"+t:a=!1,n.length-(r+e.length)>0?t+="+'":s=!1,t});return{isStatic:o,value:(a?"'":"")+i+(s?"'":"")}}function s(e){return e.replace(M.template.interpolate,function(e,t){return M.accessory.open+t+M.accessory.close}).replace(M.template.escape,function(e,t){return M.accessory.open+r(t)+M.accessory.close}).replace(M.template.evaluate,function(e,t){return"<evaluate>"+t.replace(A," ").trim()+"</evaluate>"})}function o(e,t,r){var n="";if(0!==t.length){if("string"==typeof t)n=r?t:"'"+t.replace("'","\\'")+"'";else for(var a=0;a<t.length;a++)a>0&&(n+=", "),n+=t[a];C.push(e+"("+n+");")}}function i(e,t){C.push(t?e:e.replace(A," "))}function c(e){for(var t=0,r={};t<e.length;t+=1)r[e[t].name]=e[t].value;return r}function l(e,r,n){var s,l=c(r),p=["'"+e+"'"],f=[],h=!1;if(l.hasOwnProperty(M.staticKey)&&(h=l[M.staticKey]||t(),delete l[M.staticKey]),-1===P.indexOf(e)){for(var m in l)l.hasOwnProperty(m)&&(1==p.length&&(p.push(null),p.push(null)),s=a(l[m],M.accessory.open,M.accessory.close),h&&s.isStatic?(f.push("'"+m+"'"),f.push(s.value)):(p.push("'"+m+"'"),p.push(s.value)));h&&(z[h]="["+f.join(",")+"]",p[1]="'"+t()+"'",p[2]=h),n?S.hasOwnProperty(e)?i("helpers['"+e+"']("+u(l)+");",!0):o("v",p):o("o",p)}K=e}function u(e){var t=["{"];for(var r in e)e.hasOwnProperty(r)&&(t.length>1&&t.push(","),t.push(r+":"+a(e[r],M.accessory.open,M.accessory.close).value));return t.push("}"),t.join("")}function p(e){var t;if(-1!==P.indexOf(K))i(e);else if(-1===j.indexOf(K))t=e.replace(A,"").trim(),t.length>0&&o("t",a(t,M.accessory.open,M.accessory.close).value,!0);else for(var r=e.split(A),n=0;n<r.length;n++)t=r[n],A.exec(t)?o("t",k,!0):o("t",a(t,M.accessory.open,M.accessory.close).value,!0)}function f(e){-1===P.indexOf(e)&&o("c",e)}var h=/^<([-A-Za-z0-9_]+)((?:[\s\w\-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,m=/^<\/([-A-Za-z0-9_]+)[^>]*>/,d=/([-A-Za-z0-9_]+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g,g=e("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed"),v=e("address,applet,blockquote,button,center,dd,del,dir,div,dl,dt,fieldset,form,frameset,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,script,table,tbody,td,tfoot,th,thead,tr,ul"),b=e("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),y=e("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),x=e("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),O=e(""),w=function(e,t){function r(e,r,a,s){if(r=r.toLowerCase(),v[r])for(;i.last()&&b[i.last()];)n("",i.last());if(y[r]&&i.last()==r&&n("",r),s=g[r]||!!s,s||i.push(r),t.start){var o=[];a.replace(d,function(e,t){var r=arguments[2]?arguments[2]:arguments[3]?arguments[3]:arguments[4]?arguments[4]:x[t]?t:"";o.push({name:t,value:r,escaped:r.replace(/(^|[^\\])"/g,'$1\\"')})}),t.start&&t.start(r,o,s)}}function n(e,r){var n;if(r)for(n=i.length-1;n>=0&&i[n]!=r;n--);else n=0;if(n>=0){for(var a=i.length-1;a>=n;a--)t.end&&t.end(i[a]);i.length=n}}var a,s,o,i=[],c=e;for(i.last=function(){return this[this.length-1]};e;){if(s=!0,i.last()&&O[i.last()])e=e.replace(new RegExp("(.*)</"+i.last()+"[^>]*>"),function(e,r){return r=r.replace(/<!--(.*?)-->/g,"$1").replace(/<!\[CDATA\[(.*?)]]>/g,"$1"),t.chars&&t.chars(r),""}),n("",i.last());else if(0==e.indexOf("<!--")?(a=e.indexOf("-->"),a>=0&&(t.comment&&t.comment(e.substring(4,a)),e=e.substring(a+3),s=!1)):0==e.indexOf("</")?(o=e.match(m),o&&(e=e.substring(o[0].length),o[0].replace(m,n),s=!1)):0==e.indexOf("<")&&(o=e.match(h),o&&(e=e.substring(o[0].length),o[0].replace(h,r),s=!1)),s){a=e.indexOf("<");var l=0>a?e:e.substring(0,a);e=0>a?"":e.substring(a),t.chars&&t.chars(l)}if(e==c)throw"Parse Error: "+e;c=e}n()},j=["pre","script"],P=["evaluate"],A=/(\r\n|\n|\r)/gm,k="String.fromCharCode(10)";"object"==typeof O&&(O[P]=!0);var S={},C=[],z={},K=null,M={parameterName:"data",functionName:function(e,t){return e},template:{evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},escape:/[&<>]/g,MAP:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ignore:"js",accessory:{open:"{%",close:"%}"},staticKey:"static-key"},N={compile:function(e,t){var r;n(),w(s(e),{start:l,chars:p,end:f});var a="";for(var o in z)z.hasOwnProperty(o)&&(a+="var "+o+"="+z[o]+";");return t?(a+="return function("+M.parameterName+"){"+C.join("")+"}",r=new Function("lib","helpers",a)(t,S)):r=new Function(M.parameterName,"lib","helpers",C.join("")),r},options:function(e){for(var t in e)e.hasOwnProperty(t)&&(M[t]=e[t])},registerHelper:function(e,t){S[e]=t},unregisterHelper:function(e){delete S[e]}};return N});