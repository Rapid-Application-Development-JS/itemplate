!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.itemplate=t()}(this,function(){function e(e){for(var t={},n=e.split(","),r=0;r<n.length;r++)t[n[r]]=!0;return t}function t(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n=0;12>n;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}function n(e){return e.replace(z.escape,function(e){return z.MAP[e]})}function r(){k.length=0,S={},C=null,k.push("var o=lib.elementOpen,c=lib.elementClose,t=lib.text,v=lib.elementVoid;")}function a(e,t,n){var r=new RegExp(t+"(.*?)"+n,"g"),a=!0,s=!0,l=!0,i=e.replace(r,function(e,t,n,r){return l=!1,0!==n?t="'+"+t:a=!1,r.length-(n+e.length)>0?t+="+'":s=!1,t});return{isStatic:l,value:(a?"'":"")+i+(s?"'":"")}}function s(e){return e.replace(z.template.interpolate,function(e,t){return z.helpers.open+t+z.helpers.close}).replace(z.template.escape,function(e,t){return z.helpers.open+n(t)+z.helpers.close}).replace(z.template.evaluate,function(e,t){return"<evaluate>"+t.replace(j," ").trim()+"</evaluate>"})}function l(e,t,n){var r="";if(0!==t.length){if("string"==typeof t)r=n?t:"'"+t.replace("'","\\'")+"'";else for(var a=0;a<t.length;a++)a>0&&(r+=", "),r+=t[a];k.push(e+"("+r+");")}}function i(e,t){k.push(t?e:e.replace(j," "))}function o(e){for(var t=0,n={};t<e.length;t+=1)n[e[t].name]=e[t].value;return n}function c(e,n,r){var s,i=o(n),c=["'"+e+"'"],p=[],u=!1;if(i.hasOwnProperty(z.staticKey)&&(u=i[z.staticKey]||"'"+t()+"'",delete i[z.staticKey]),-1===A.indexOf(e)){for(var f in i)i.hasOwnProperty(f)&&(1==c.length&&(c.push(null),c.push(null)),s=a(i[f],z.helpers.open,z.helpers.close),u&&s.isStatic?(p.push("'"+f+"'"),p.push(s.value)):(c.push("'"+f+"'"),c.push(s.value)));u&&(S[u]="["+p.join(",")+"]",c[1]="'"+t()+"'",c[2]=u),r?l("v",c):l("o",c)}C=e}function p(e){var t;if(-1!==A.indexOf(C))i(e);else if(-1===w.indexOf(C))t=e.replace(j,"").trim(),t.length>0&&l("t",a(t,z.helpers.open,z.helpers.close).value,!0);else for(var n=e.split(j),r=0;r<n.length;r++)t=n[r],j.exec(t)?l("t",P,!0):l("t",a(t,z.helpers.open,z.helpers.close).value,!0)}function u(e){-1===A.indexOf(e)&&l("c",e)}var f=/^<([-A-Za-z0-9_]+)((?:[\s\w\-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,h=/^<\/([-A-Za-z0-9_]+)[^>]*>/,d=/([-A-Za-z0-9_]+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g,m=e("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed"),g=e("address,applet,blockquote,button,center,dd,del,dir,div,dl,dt,fieldset,form,frameset,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,script,table,tbody,td,tfoot,th,thead,tr,ul"),v=e("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),b=e("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),x=e("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),y=e(""),O=function(e,t){function n(e,n,a,s){if(n=n.toLowerCase(),g[n])for(;i.last()&&v[i.last()];)r("",i.last());if(b[n]&&i.last()==n&&r("",n),s=m[n]||!!s,s||i.push(n),t.start){var l=[];a.replace(d,function(e,t){var n=arguments[2]?arguments[2]:arguments[3]?arguments[3]:arguments[4]?arguments[4]:x[t]?t:"";l.push({name:t,value:n,escaped:n.replace(/(^|[^\\])"/g,'$1\\"')})}),t.start&&t.start(n,l,s)}}function r(e,n){var r;if(n)for(r=i.length-1;r>=0&&i[r]!=n;r--);else r=0;if(r>=0){for(var a=i.length-1;a>=r;a--)t.end&&t.end(i[a]);i.length=r}}var a,s,l,i=[],o=e;for(i.last=function(){return this[this.length-1]};e;){if(s=!0,i.last()&&y[i.last()])e=e.replace(new RegExp("(.*)</"+i.last()+"[^>]*>"),function(e,n){return n=n.replace(/<!--(.*?)-->/g,"$1").replace(/<!\[CDATA\[(.*?)]]>/g,"$1"),t.chars&&t.chars(n),""}),r("",i.last());else if(0==e.indexOf("<!--")?(a=e.indexOf("-->"),a>=0&&(t.comment&&t.comment(e.substring(4,a)),e=e.substring(a+3),s=!1)):0==e.indexOf("</")?(l=e.match(h),l&&(e=e.substring(l[0].length),l[0].replace(h,r),s=!1)):0==e.indexOf("<")&&(l=e.match(f),l&&(e=e.substring(l[0].length),l[0].replace(f,n),s=!1)),s){a=e.indexOf("<");var c=0>a?e:e.substring(0,a);e=0>a?"":e.substring(a),t.chars&&t.chars(c)}if(e==o)throw"Parse Error: "+e;o=e}r()};const w=["pre","script"],A=["evaluate"],j=/(\r\n|\n|\r)/gm,P="String.fromCharCode(10)";"object"==typeof y&&(y[A]=!0);var k=[],S={},C=null,z={parameterName:"data",functionName:function(e,t){return e},template:{evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},escape:/[&<>]/g,MAP:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ignore:"js",helpers:{open:"{%",close:"%}"},staticKey:"static-key"},K={compile:function(e,t){r(),O(s(e),{start:c,chars:p,end:u});var n="";for(var a in S)S.hasOwnProperty(a)&&(n+="var "+a+"="+S[a]+";");return n+="return function("+z.parameterName+"){"+k.join("")+"}",new Function("lib",n)(t)},options:function(e){for(var t in e)e.hasOwnProperty(t)&&(z[t]=e[t])}};return K});